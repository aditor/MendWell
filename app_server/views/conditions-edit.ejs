<!DOCTYPE html>
<html>
  <head>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/stylesheets/style.css">
    <script src="../../javascripts/jquery-3.2.1.min.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../javascripts/jquery.imagemapster.js"></script>

  </head>

  <body>

    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header"><a class="navbar-brand" href="/">MendWell</a>
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button>
        </div>
        <div class="navbar-collapse collapse" id="navbar-main">
          <ul class="nav navbar-nav">
            <li><a href="/about/">About</a></li>
          </ul>
        </div>
      </div>
    </div>

</html>

  <div class="page-header" id="banner">
    <div class="row">
      <div class="col-lg-6">
        <h1>Add a Condition<br></h1>
        <h4>Enter your symptoms and choose the corresponding medications</h4>
      </div>
    </div>
  </div>

  <div class="col-xs-12">
                      <div class="col-xs-4">         
                        <div class="well well-lg">
                          <div >
                            <button onclick="listFunction()" class="btn btn-info">Add a Row</button>
                            <button id="clear" onclick="clearList()" class="btn btn-warning">Clear</button>
                          
                          </div>

                          <h4>Search Conditions</h4>
                          <div class="col-xs-8">
                              <input class="form-control" id="condInput" type="text" placeholder="Enter your symptoms">
                          </div>
                          <div class="col-xs-1">
                              <button class="btn btn-info" id="condSubmit" href="/api/morning" >Submit</button>
                          </div>

                          <div class="col-xs-8">
                              <input class="form-control" id="severityInput" type="text" placeholder="Enter condition severity">
                          </div>
                          <div class="col-xs-1">
                              <button class="btn btn-info" id="severitySubmit" >Submit</button>
                          </div>
                        </div>

                      </div>
                      <div class="col-xs-4">
                          <div class="well well-lg">

                           <!-- ADD A SAVE METHOD HERE -->
                             <button id="save" class="btn btn-success">Save</button>
                          <h4>Condition</h4>

                          <ul id="submissionList" style="list-style-type: none" ;>
                              
                          </ul>
                        </div>
                         
                      </div>

                      <div class="col-xs-4">
                          <table id="tblMeds" class="table table-striped table-hover ">
    
                          </table>  
                        </div>
  </div>




   <div class="container">
      <footer>
        <div class="row">
          <div class="col-xs-12"><small>&copy; Adi Kamath 2017</small></div>
        </div>
      </footer>
    </div>

    <script>


    //script for managing the condition submission form beside the input

    //TODO: add check for if the medicaiton exists in the table, also add functiionality to remove the condition from the table
    //also try to include all the data in a table

    function addtoFinalForm(conditionName){
      var node = document.createElement("Li");
      var textnode=document.createTextNode(conditionName);
      node.appendChild(textnode);
      var list = document.getElementById("submissionList")

      var listItem = list.getElementsByTagName("li");

      var toAdd = true;

      for (var i=0; i < listItem.length; i++) {
          if(listItem[i].innerHTML === conditionName){
              toAdd = false;
          }
      }
      if(toAdd){
        var delButton = document.createElement("button");
        var outderDel = delButton;
        var outerNode = node;
        delButton.addEventListener("click", function(e) {
          list.removeChild(outerNode);
          list.removeChild(outderDel);
        }, false);
        delButton.innerHTML = "Remove";
        list.appendChild(node);
        list.appendChild(delButton);
      }
    }


    function listFunction() {
      var lis = document.getElementById("mainList");
      var singleRow = document.getElementById("bunch");
      var duplicated = singleRow.cloneNode(true);
      var li = document.createElement('li');
      li.appendChild(duplicated)
      lis.appendChild(li);
    }


      function clearList(){
        var root = document.getElementById("mainList");
        var savedBunch = document.getElementById("bunch");
        root.innerHTML = '';
        var entry = document.createElement('li');
        entry.appendChild(savedBunch);
        root.appendChild(entry);
      }

      function generateMedList(data){
            var tbl_body = document.createElement("tbody");
            tbl_body.setAttribute("id", "resultTable");
            var odd_even = false;
//            console.log("DATA", data);
            $.each(data, function(index, value){
                var tbl_row = tbl_body.insertRow();
                var cell = tbl_row.insertCell();
                var medd = document.createElement("p");
                medd.innerHTML = value;
                medd.addEventListener("click", function(e) {
                    addtoFinalForm(value);
                }, false);
                cell.appendChild(medd); 
            })
            var tab = document.getElementById("tblMeds");
            tab.innerHTML = '';
            tab.appendChild(tbl_body);
    }

      function generateButtonList(data){
            var tbl_body = document.createElement("tbody");
            tbl_body.setAttribute("id", "resultTable");
            var odd_even = false;
//            console.log("DATA", data);
            $.each(data, function(index, value){
                var tbl_row = tbl_body.insertRow();
                //tbl_row.className = odd_even ? "odd" : "even";
                console.log(value.name)
                var cell = tbl_row.insertCell();
                var butt = document.createElement("a");
                butt.innerHTML = value.name.name;
                butt.addEventListener("click", function(e) {
                    addtoFinalForm("Condition name: " + value.name.name);
                }, false);
                butt.setAttribute('onclick', "findMeds('" + value.link + "')");
                cell.appendChild(butt);                      
                //odd_even = !odd_even;
            })
            var tab = document.getElementById("tblMeds");
            tab.innerHTML = '';
            tab.appendChild(tbl_body);
    }


      $("#condSubmit").click(function(){
        var tab = document.getElementById("tblMeds");
        var text = document.getElementById("condInput").value;
        if(tab != null){
            tab.innerHTML = '';
        }
        $.ajax({
            url: 'http://localhost:3000/api/morning',
            type: 'post',
//            data: JSON.stringify(query),
            data: JSON.stringify({"stuff":text}),
            dataType: 'json',
            contentType: 'application/json'
        }).done(function(data){
          console.log("FIRST");
          console.log(data);
          console.log("SECOND");
//            console.log("MAIN DATA", data)
//            console.log("Response", data);
          generateButtonList(data);
        }).fail(function(data){
            console.error("ERROR - Failed:" + data);
        });
    })

      function findMeds(link){
        console.log(link)
        var tab = document.getElementById("tblMeds");
        if(tab != null){
            tab.innerHTML = '';
        }
        $.ajax({
            url: 'http://localhost:3000/api/shit',
            type: 'post',
//            data: JSON.stringify(query),
            data: JSON.stringify({"stuff":link}),
            dataType: 'json',
            contentType: 'application/json'
        }).done(function(data){
          console.log("FIRST");
          console.log(data);
          console.log("SECOND");
//            console.log("MAIN DATA", data)
//            console.log("Response", data);
          generateMedList(data[0].medication);
        }).fail(function(data){
            console.error("ERROR - Failed:" + data);
        });
    }


    </script>

  </body>




    <!-- copy of submit and form above -->
                  <!-- <div class="form-group">
                      <input class="form-control" id="focusedInput" type="text" placeholder="Enter your condition" style="float: left">
                      <a class="btn btn-info" href="/api/morning" style="float: right;">Submit</a>
                  </div>   -->

                  <!-- the ORANGE little boxes I had before -->

                  <!-- <p><span class="label label-warning">Left leg</span>
                    <span class="label label-warning">Right arm</span>
                    <span class="label label-warning">Head</span>
                  </p> -->

                 <!--  <h4>
                    Medications
                  </h4>
                          <ul id="mainList" style="list-style-type: none" ;>
                              <li>
                                  <div id = "bunch" style="clear: left;">
                                      
                                        <div class="form-group" style="float: left">
                                          <input class="form-control" id="focusedInput" type="text" placeholder="Enter medication">
                                        </div>  

                                         <div class="form-group" style="float: left">
                                          <input class="form-control" id="focusedInput" type="text" placeholder="Enter dosage">
                                        </div>  
                                                  
                                  </div>
                              </li>
                          </ul>
                          -->