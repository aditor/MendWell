<!DOCTYPE html>
<html>
  <head>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/stylesheets/style.css">
    <script src="../../javascripts/jquery-3.2.1.min.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../javascripts/jquery.imagemapster.js"></script>

  </head>

  <body>

    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header"><a class="navbar-brand" href="/">MendWell</a>
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button>
        </div>
        <div class="navbar-collapse collapse" id="navbar-main">
          <ul class="nav navbar-nav">
            <li><a href="/about/">About</a></li>
          </ul>
        </div>
      </div>
    </div>

</html>

  <div class="page-header" id="banner">
    <div class="row">
      <div class="col-lg-6">
        <h1>Edit Details<br><small>&nbsp;</small></h1>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-12 col-sm-8">
      <div class="row list-group">
        <div class="col-xs-12 list-group-item">
               <div class="well well-lg">
          
                  <h4> 
                    <a href="/block">Date: 05/08/2017</a>
                  </h4>

                  <div style="clear: left;">
                    <button onclick="listFunction()" class="btn btn-info">Add a Row</button>
                    <button id="clear" onclick="clearList()" class="btn btn-warning">Clear</button>
                    <!-- ADD A SAVE METHOD HERE -->
                     <button id="save" class="btn btn-success">Save</button>
                  </div>

                  <h4>Condition</h4>
                  
                  <div class="form-group">
                      <input class="form-control" id="condInput" type="text" placeholder="Enter your condition" style="float: left">
                      <button class="btn btn-info" id="condSubmit" href="/api/morning" style="float: right;">Submit</button>
                  </div>  


                  <!-- copy of submit and form above -->
                  <!-- <div class="form-group">
                      <input class="form-control" id="focusedInput" type="text" placeholder="Enter your condition" style="float: left">
                      <a class="btn btn-info" href="/api/morning" style="float: right;">Submit</a>
                  </div>   -->







                  <!-- the ORANGE little boxes I had before -->

                  <!-- <p><span class="label label-warning">Left leg</span>
                    <span class="label label-warning">Right arm</span>
                    <span class="label label-warning">Head</span>
                  </p> -->

                 <!--  <h4>
                    Medications
                  </h4>
                          <ul id="mainList" style="list-style-type: none" ;>
                              <li>
                                  <div id = "bunch" style="clear: left;">
                                      
                                        <div class="form-group" style="float: left">
                                          <input class="form-control" id="focusedInput" type="text" placeholder="Enter medication">
                                        </div>  

                                         <div class="form-group" style="float: left">
                                          <input class="form-control" id="focusedInput" type="text" placeholder="Enter dosage">
                                        </div>  
                                                  
                                  </div>
                              </li>
                          </ul>
                          -->
                </div>
        </div>
      </div>
    </div>
  </div>

  


  <table id="tblMeds" class="table table-striped table-hover ">
    
  </table>  



   <div class="container">
      <footer>
        <div class="row">
          <div class="col-xs-12"><small>&copy; Adi Kamath 2017</small></div>
        </div>
      </footer>
    </div>

    <script>
      function listFunction() {
              var lis = document.getElementById("mainList");
              var singleRow = document.getElementById("bunch");
              var duplicated = singleRow.cloneNode(true);
              var li = document.createElement('li');
              li.appendChild(duplicated)
              lis.appendChild(li);
      }


      function clearList(){
        var root = document.getElementById("mainList");
        var savedBunch = document.getElementById("bunch");
        root.innerHTML = '';
        var entry = document.createElement('li');
        entry.appendChild(savedBunch);
        root.appendChild(entry);
      }

      function generateMedList(data){
            var tbl_body = document.createElement("tbody");
            tbl_body.setAttribute("id", "resultTable");
            var odd_even = false;
//            console.log("DATA", data);
            $.each(data, function(){
                var tbl_row = tbl_body.insertRow();
                tbl_row.className = odd_even ? "odd" : "even";
                $.each(this, function(k, v){
                    var cell = tbl_row.insertCell();

                    cell.appendChild(document.createTextNode(v.toString()));
                })
                odd_even = !odd_even;
            })
            var tab = document.getElementById("tblMeds");
            tab.innerHTML = '';
            tab.appendChild(tbl_body);
    }

      function generateButtonList(data){
            var tbl_body = document.createElement("tbody");
            tbl_body.setAttribute("id", "resultTable");
            var odd_even = false;
//            console.log("DATA", data);
            $.each(data, function(index, value){
                var tbl_row = tbl_body.insertRow();
                //tbl_row.className = odd_even ? "odd" : "even";
                console.log(value.name)
                var cell = tbl_row.insertCell();
                var butt = document.createElement("a");
                butt.innerHTML = value.name.name;
                butt.setAttribute('onclick', "findMeds('" + value.link + "')");
                cell.appendChild(butt);                      
                //odd_even = !odd_even;
            })
            var tab = document.getElementById("tblMeds");
            tab.innerHTML = '';
            tab.appendChild(tbl_body);
    }


      $("#condSubmit").click(function(){
        var tab = document.getElementById("tblMeds");
        var text = document.getElementById("condInput").value;
        if(tab != null){
            tab.innerHTML = '';
        }
        $.ajax({
            url: 'http://localhost:3000/api/morning',
            type: 'post',
//            data: JSON.stringify(query),
            data: JSON.stringify({"stuff":text}),
            dataType: 'json',
            contentType: 'application/json'
        }).done(function(data){
          console.log("FIRST");
          console.log(data);
          console.log("SECOND");
//            console.log("MAIN DATA", data)
//            console.log("Response", data);
          generateButtonList(data);
        }).fail(function(data){
            console.error("ERROR - Failed:" + data);
        });
    })

      function findMeds(link){
        console.log(link)
        var tab = document.getElementById("tblMeds");
        if(tab != null){
            tab.innerHTML = '';
        }
        $.ajax({
            url: 'http://localhost:3000/api/shit',
            type: 'post',
//            data: JSON.stringify(query),
            data: JSON.stringify({"stuff":link}),
            dataType: 'json',
            contentType: 'application/json'
        }).done(function(data){
          console.log("FIRST");
          console.log(data);
          console.log("SECOND");
//            console.log("MAIN DATA", data)
//            console.log("Response", data);
          generateMedList(data);
        }).fail(function(data){
            console.error("ERROR - Failed:" + data);
        });
    }


    </script>

  </body>